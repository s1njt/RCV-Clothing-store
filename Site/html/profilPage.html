<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="..//css/profil.css">

    <link rel="icon" href="../icon/rcvlogo.png">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossoWrigin>
    <script src="https://cdn.jsdelivr.net/npm/qrcode"></script>
    <link href="https://fonts.googleapis.com/css2?family=Jost:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <title>RCV</title>
</head>
<body>
    <header>
        <!-- –°—Å—ã–ª–∫–∏ —Å–ª–µ–≤–∞ -->
        <div class="left-links">
            <a href="..//html/authUserNovinkiPage.html">–ù–û–í–ò–ù–ö–ò</a>
            <a href="#" id="catalog-link">–ö–ê–¢–ê–õ–û–ì ü°´</a>
            <a href="..//html/authUserMagazineAdressPage.html" id="offMagazin-link">–û–§–§ –ú–ê–ì–ê–ó–ò–ù–´</a>
        </div>

        <!-- –í—ã–ø–∞–¥–∞—é—â–µ–µ –º–µ–Ω—é –∫–∞—Ç–∞–ª–æ–≥–∞ -->
        <div class="catalog-form" id="catalog-form">
            <div class="catalog-block">
                <h1>–í–ï–†–•</h1>
                <ul>
                    <li><a href="#">–§–£–¢–ë–û–õ–ö–ò –ò –¢–û–ü–´</a></li>
                    <li><a href="#">–†–£–ë–ê–®–ö–ò</a></li>
                    <li><a href="#">–ü–£–õ–û–í–ï–†–´ –ò –°–í–ò–¢–®–û–¢–´</a></li>
                    <li><a href="..//html/authUserPalto.html">–ü–ê–õ–¨–¢–û –ò –ö–£–†–¢–ö–ò</a></li>
                </ul>
            </div>
            <div class="catalog-block">
                <h1>–ù–ò–ó</h1>
                <ul>
                    <li><a href="../html/authUserKatalogBrukoDginsiPage.html">–ë–†–Æ–ö–ò –ò –î–ñ–ò–ù–°–´</a></li>
                    <li><a href="#">–ü–õ–ê–¢–¨–Ø –ò –Æ–ë–ö–ò</a></li>
                </ul>
            </div>
            <div class="catalog-block">
                <h1>–û–ë–£–í–¨</h1>
                <ul>
                    <li><a href="#">–ö–†–û–°–û–í–ö–ò</a></li>
                    <li><a href="#">–ë–û–¢–ò–ù–ö–ò</a></li>
                    <li><a href="#">–¢–£–§–õ–ò</a></li>
                </ul>
            </div>
            <div class="catalog-block">
                <h1>–ê–ö–°–´</h1>
                <ul>
                    <li><a href="#">–ü–û–î–í–ï–°–ö–ò</a></li>
                    <li><a href="#">–ö–û–õ–¨–¶–ê</a></li>
                    <li><a href="#">–ë–†–ê–°–õ–ï–¢–´</a></li>
                    <li><a href="#">–ì–†–ò–õ–ó–´</a></li>
                    <li><a href="#">–°–ï–†–¨–ì–ò</a></li>
                </ul>
            </div>
        </div>

        <!-- –õ–æ–≥–æ—Ç–∏–ø-->
        <a href="..//html/authUserMainPage.html" class="center-title">RCV</a>

        <!--  –°—Å—ã–ª–∫–∏ —Å–ø—Ä–∞–≤–∞ -->
        <div class="right-links">
            <a href="..//html/sapportPage.html" id="sapport-link">–°–ê–ü–ü–û–†–¢</a>
            <a href="..//html/profilPage.html" id="profile-link">404</a>
            <script>
                // –ò–∑–≤–ª–µ–∫–∞–µ–º nickname –∏–∑ localStorage
                const nickname = localStorage.getItem('nickname');
                document.getElementById('profile-link').innerText = nickname;
            </script>
            <a href="#"><img src="..//icon/search.png" alt="–ü–û–ò–°–ö" id="search-link"></a>
            <a href="..//html/backpack.html"><img src="..//icon/backpack.png" alt="–†–Æ–ö–ó–ê–ö" id="backpack-link"></a>
        </div>

        <!-- –ü–æ–∏—Å–∫ –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–µ -->
        <div class="search-form" id="search-form">
            <div class="search">
                <input type="text" class="search-input" placeholder="–ü–û–ò–°–ö –ü–û –°–ê–ô–¢–£">
                <a href="#" id="send-link">ü°™</a>
            </div>
            <div class="result">
                <div id="search-result"></div> <!-- –ë–ª–æ–∫ –¥–ª—è –≤—ã–≤–æ–¥–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ -->
            </div>
            <div class="search-results-col">
                <label>–ö–û–õ–ò–ß–ï–°–¢–í–û –†–ï–ó–£–õ–¨–¢–ê–¢–û–í: </label>
                <div id="result-count"></div> <!-- –ë–ª–æ–∫ –¥–ª—è –≤—ã–≤–æ–¥–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ -->
            </div>
        </div>
    </header>
    <h1 class="zagalovok">–ü–†–û–§–ò–õ–¨</h1>

    <!-- –ì–ª–∞–≤–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
    <div class="container">

        <!-- –î–∞–Ω–Ω—ã–µ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è -->
        <div class="user-data-list">
            <h1 class="userNickname">PEPELNO BELIY</h1>
            <h2 class="userSmaller">–ù–ò–ñ–ù–ò–ô –ù–û–í–ì–û–†–û–î</h2>
            <p class="userEmail">soft1k69@mail.ru</p>
            <p class="userPhone">+8(952)-67-157-89</p>
            <button class="edit-button">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
            <h2>QR-–ö–û–î –î–õ–Ø –ü–û–õ–£–ß–ï–ù–ò–Ø –ó–ê–ö–ê–ó–ê</h2>

            
            <img src="..//icon/qr-code.png" alt="QR Code" class="qr-code" id="qrCode">
            
            <script>
                // –ù–ò–ö –ù–ï–ô–ú
                const userNickname = localStorage.getItem('nickname');
                document.querySelector('.userNickname').innerText = userNickname;
            
                // –ì–û–†–û–î
                const userCity = localStorage.getItem('city');
                document.querySelector('.userSmaller').innerText = userCity;
            
                // –≠–ú–ï–ô–õ
                const userEmail = localStorage.getItem('userEmail');
                document.querySelector('.userEmail').innerText = userEmail;
            
                // –¢–ï–õ–ï–§–û–ù
                const userPhone = localStorage.getItem('phone');
                document.querySelector('.userPhone').innerText = userPhone;
            
                const userId = localStorage.getItem('id');
                console.log('User ID:', userId);
            
                async function fetchAllTickets() {
                    const response = await fetch(`http://192.168.45.250:3000/api/Tickets/GetTickets?ticket_acceptUserId=${userId}`, {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });
                    if (!response.ok) {
                        throw new Error('Failed to fetch tickets');
                    }
                    const data = await response.json();
            
                    data.forEach(ticket => {
                        console.log('"ticket_acceptUserId": "', ticket.ticket_acceptUserId, '"');
                    });
            
                    return data;
                }
            
                async function displayAllTickets(tickets) {
                    const orderDetailsTable = document.querySelector('.order-details tbody');
                    orderDetailsTable.innerHTML = '';
                    
                    let ordersData = "";
            
                    tickets.forEach(ticket => {
                        if (ticket.ticket_acceptUserId === userId) {
                            const row = document.createElement('tr');
            
                            // Column: –§–û–¢–û –ù–ê–ó–í–ê–ù–ò–ï
                            const imageCell = document.createElement('td');
                            const image = document.createElement('img');
                            image.src = `../image/novinki/${ticket.ticket_productsId}.png`; 
                            image.alt = `–¢–æ–≤–∞—Ä ${ticket.ticket_productsId}`;
                            image.onerror = function() {
                                this.onerror = null;
                                this.src = '../image/novinki/zagluha.png'; 
                            };
                            imageCell.appendChild(image);
                            row.appendChild(imageCell);
            
                            // Column: –ê–†–¢–ò–ö–£–õ–¨
                            const articulCell = document.createElement('td');
                            articulCell.textContent = ticket.ticket_productsId; 
                            row.appendChild(articulCell);
            
                            // Column: –°–£–ú–ú–ê
                            const sumCell = document.createElement('td');
                            sumCell.textContent = `‚ÇΩ${ticket.ticket_sum.toFixed(2)}`;
                            row.appendChild(sumCell);
            
                            // Column: –î–ê–¢–ê
                            const dateCell = document.createElement('td');
                            dateCell.textContent = new Date(ticket.ticket_createDate).toLocaleDateString();
                            row.appendChild(dateCell);
            
                            // Column: –°–¢–ê–¢–£–°
                            const statusCell = document.createElement('td');
                            statusCell.textContent = ticket.ticket_deliveryStatus;
                            row.appendChild(statusCell);
            
                            // Column: –ê–î–†–ï–° –î–û–°–¢–ê–í–ö–ò
                            const addressCell = document.createElement('td');
                            addressCell.textContent = ticket.ticket_deliveryAdress;
                            row.appendChild(addressCell);
            
                            // Column: –û–¢–û–ó–í–ê–¢–¨ –ó–ê–ö–ê–ó
                            const cancelCell = document.createElement('td');
                            const cancelButton = document.createElement('button');
                            cancelButton.textContent = '–û–¢–û–ó–í–ê–¢–¨';
                            cancelButton.classList.add('cancel-button');
                            cancelButton.addEventListener('click', () => {
                                alert('–¢–û–í–ê–† –£–°–ü–ï–®–ù–û –û–¢–û–ó–í–ê–ù');
                                row.remove();
                            });
                            cancelCell.appendChild(cancelButton);
                            row.appendChild(cancelCell);
            
                            orderDetailsTable.appendChild(row);
            
                            // Append order data to QR code data
                            ordersData += `–¢–æ–≤–∞—Ä: ${ticket.ticket_productsId}\n\n –°—É–º–º–∞: ‚ÇΩ${ticket.ticket_sum.toFixed(2)}\n\n –î–∞—Ç–∞: ${new Date(ticket.ticket_createDate).toLocaleDateString()}\n\n`;
                        }
                    });
            
                    // Update QR code with order details
                    const qrData = `–ù–∏–∫: ${userNickname}\n–ì–æ—Ä–æ–¥: ${userCity}\nEmail: ${userEmail}\n–¢–µ–ª–µ—Ñ–æ–Ω: ${userPhone}\n\n–ó–ê–ö–ê–ó–´:\n${ordersData}`;
                    const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=400x400&data=${encodeURIComponent(qrData)}&bgcolor=E1E1E1`;
                    const qrCodeImg = document.getElementById('qrCode');
                    qrCodeImg.src = qrUrl;
            
                    addSubmitButtonClickListener();
                }
            
                function addSubmitButtonClickListener() {
                    const buttons = document.querySelectorAll('.submit-button');
                    buttons.forEach(button => {
                        button.addEventListener('click', (event) => {
                            const productData = event.currentTarget.getAttribute('data-product');
                            localStorage.setItem('selectedProduct', productData);
                        });
                    });
                }
            
                async function fetchAndDisplayTickets() {
                    try {
                        const tickets = await fetchAllTickets();
                        await displayAllTickets(tickets);
                    } catch (error) {
                        console.error('Error loading tickets:', error);
                    }
                }
            
                fetchAndDisplayTickets();
            </script>



            <p class="description">–ü–û–î–ü–ò–®–ò–¢–ï–°–¨ –ù–ê –†–ê–ù–ù–ò–ô –î–û–°–¢–£–ü –ö –ù–û–í–´–ú –í–´–ü–£–°–ö–ê–ú–ò –°–≠–ö–û–ù–û–ú–¨–¢–ï 10% –ù–ê –°–í–û–ï–ú –ü–ï–†–í–û–ú –ó–ê–ö–ê–ó–ï.</p>
            <div class="mail-input">
                <input type="text" placeholder="E-MAIL">
            </div>
            <button class="subscribe-button">–ü–û–î–ü–ò–°–ê–¢–¨–°–Ø</button>
        </div>

        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≤—ã–≤–æ–¥–∞ –¥–∞–Ω–Ω—ã—Ö -->
        <div class="main-content">

            <!-- –ü–æ–∏—Å–∫ –ø–æ –∑–∞–∫–∞–∑–∞–º -->
            <div class="message-input">
                <input type="text" placeholder="–ü–û–ò–°–ö –ü–û –ó–ê–ö–ê–ó–ê–ú">
                <a href="#" class="send-button">ü°¢</a>
            </div>

            <!-- –ò—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–∫–∞–∑–∞—Ö -->
            <div class="order-details">
                <table>
                    <thead>
                        <tr>
                            <th>–§–û–¢–û –ù–ê–ó–í–ê–ù–ò–ï</th>
                            <th>–ê–†–¢–ò–ö–£–õ–¨</th>
                            <th>–°–£–ú–ú–ê</th>
                            <th>–î–ê–¢–ê</th>
                            <th>–°–¢–ê–¢–£–°</th>
                            <th>–ê–î–†–ï–° –î–û–°–¢–ê–í–ö–ò</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><img src="..//image/novinki/dgins.png" alt="–¢–æ–≤–∞—Ä 1"></td>
                            <td>–î–ñ–†–°–í24–ì</td>
                            <td>‚ÇΩ1900.00</td>
                            <td>2024-02-24</td>
                            <td>–û–ü–õ–ê–ß–ï–ù</td>
                            <td>–ù–ò–ñ–ù–ò–ô –ù–û–í–ì–û–†–û–î, –î–û–ú 14,–£–õ.–ö–ê–õ–ê–¢–£–®–ö–ò–ù–ê, –ü–ê–î–ò–ö 4,–ö–í.1</td>
                        </tr>
                    </tbody>
                </table>

                <!-- –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –∑–∞–∫–∞–∑–æ–º -->
                <div class="buttons">
                    <button class="cancel-button">–û–¢–û–ó–í–ê–¢–¨</button>
                </div>
            </div>
        </div>
    </div>
    <footer>
        <div class="column">
            <a href="#">¬© RCV/2024</a>
        </div>
        <div class="column">
            <a href="#">–ü–û–õ–ò–¢–ò–ö–ê –í–û–ó–†–ê–¢–ê –°–†–ï–î–°–¢–í</a>
            <a href="#">–û–¢–ü–ï–ß–ê–¢–ö–ò</a>
            <a href="#">–ö–õ–ò–ï–ù–¢–´</a>
        </div>
        <div class="column">
            <a href="https://vk.com/ashxwhite">VK</a>
            <a href="https://t.me/ASHXWHITE">TELEGRAM</a>
            <a href="https://www.behance.net/ashxwhite">BEHENCE</a>
            <a href="https://github.com/s1njt">GIT</a>
        </div>
    </footer>
    <script src="..//js/main.js"></script>
    <script src="..//js/searth.js"></script>
    <script src="..//js/API/profilAPI.js"></script>
</body>
</html>